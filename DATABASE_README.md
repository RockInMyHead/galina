# üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Galina AI

## üìã –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç Galina AI —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **SQLite –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–æ–≤ –∏ —Ñ–∞–π–ª–æ–≤. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
User {
  id: String (CUID)
  email: String (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
  name: String (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  createdAt: DateTime
  updatedAt: DateTime
}

-- –°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞
ChatMessage {
  id: String (CUID)
  content: String
  role: String ('user' | 'assistant')
  timestamp: DateTime
  userId: String (–≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á)
}

-- –§–∞–π–ª—ã
File {
  id: String (CUID)
  name: String
  type: String
  size: Int
  content: String (base64)
  url: String (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è Supabase)
  userId: String (–≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á)
  messageId: String (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á)
  createdAt: DateTime
}

-- –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
UserBalance {
  id: String (CUID)
  amount: Int (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1000)
  userId: String (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á)
}
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd api
npm install
```

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma –∫–ª–∏–µ–Ω—Ç–∞
npm run db:generate

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
npm run db:push

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
node create-demo-user.js

# –ú–∏–≥—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
npm run db:migrate-data
```

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
npm run dev
```

## üì° API Endpoints

### –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞
```http
GET /api/chat/history
```
**–û—Ç–≤–µ—Ç:**
```json
{
  "messages": [
    {
      "id": "cmhon5ev80004vcy3jx831ce1",
      "content": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –ì–∞–ª–∏–Ω–∞...",
      "role": "assistant",
      "timestamp": "2025-11-07T08:16:21.763Z",
      "userId": "cmhon4yn00000vcufkcr0t86v",
      "files": []
    }
  ]
}
```

### –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```http
GET /api/user/profile
```
**–û—Ç–≤–µ—Ç:**
```json
{
  "user": {
    "id": "cmhon4yn00000vcufkcr0t86v",
    "email": "demo@galina.ai",
    "name": "Demo User",
    "balance": { "amount": 1000 },
    "messages": [...],
    "files": [...]
  }
}
```

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
```http
POST /api/chat/message
Content-Type: application/json

{
  "content": "–ü—Ä–∏–≤–µ—Ç, –ì–∞–ª–∏–Ω–∞!",
  "role": "user",
  "files": []
}
```

### –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
```http
POST /api/files/upload
Content-Type: application/json

{
  "name": "document.pdf",
  "type": "application/pdf",
  "size": 245760,
  "content": "base64_encoded_content"
}
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```http
GET /api/stats
```
**–û—Ç–≤–µ—Ç:**
```json
{
  "stats": {
    "messages": 9,
    "files": 2,
    "balance": 1000
  }
}
```

### –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
```http
DELETE /api/chat/history
```

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma –∫–ª–∏–µ–Ω—Ç–∞
npm run db:generate

# –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã
npm run db:push

# –û—Ç–∫—Ä—ã—Ç–∏–µ Prisma Studio (GUI)
npm run db:studio

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
npm run db:test

# –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
npm run db:migrate-data
```

### Prisma Studio

```bash
npm run db:studio
# –û—Ç–∫—Ä–æ–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä –Ω–∞ http://localhost:5555
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–§–∞–π–ª `api/.env.local`:

```env
# OpenAI API Key
OPENAI_API_KEY=your_openai_api_key

# SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL="file:./galina.db"
```

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (Supabase)

```env
# Supabase PostgreSQL
DATABASE_URL="postgresql://postgres:password@db.your-project.supabase.co:5432/postgres"
SUPABASE_URL="https://your-project.supabase.co"
SUPABASE_ANON_KEY="your-anon-key"
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–∑—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
npm run db:studio

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞
npm run dev
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –±–∞–∑—ã

```
api/
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma          # –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ galina.db             # SQLite —Ñ–∞–π–ª –±–∞–∑—ã
‚îú‚îÄ‚îÄ create-demo-user.js       # –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ migrate-data.js           # –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ test-db.js               # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
‚îî‚îÄ‚îÄ index.js                 # API —Å–µ—Ä–≤–µ—Ä —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ë–î
```

## üöÄ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ PostgreSQL

1. **–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É –≤ `prisma/schema.prisma`:**
   ```prisma
   datasource db {
     provider = "postgresql"
     url      = env("DATABASE_URL")
   }
   ```

2. **–û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```env
   DATABASE_URL="postgresql://user:password@localhost:5432/galina_db"
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:**
   ```bash
   npm run db:push
   ```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase

1. **–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ Supabase**
2. **–û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Row Level Security (RLS)**
4. **–î–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: "Cannot fetch data from service"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `DATABASE_URL` –≤ `.env.local`
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ñ–∞–π–ª `galina.db` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

### –ü—Ä–æ–±–ª–µ–º–∞: "P1001: Can't reach database server"

**–†–µ—à–µ–Ω–∏–µ:**
- –î–ª—è SQLite: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
- –î–ª—è PostgreSQL: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

### –ü—Ä–æ–±–ª–µ–º–∞: "Prisma client not generated"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npm run db:generate
```

## üìà –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase Auth
2. **–§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** - Supabase Storage –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
3. **Real-time –ø–æ–¥–ø–∏—Å–∫–∏** - Supabase Realtime –¥–ª—è live-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
4. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±—ç–∫–∞–ø–æ–≤
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üéØ –†–µ–∑—é–º–µ

‚úÖ **SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** —É—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞
‚úÖ **Prisma ORM** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç type-safe –¥–æ—Å—Ç—É–ø
‚úÖ **REST API** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ PostgreSQL/Supabase
‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - —É–¥–æ–±–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ Prisma Studio

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É! üöÄüìä‚öñÔ∏è
