# Исправление голосового распознавания

## Проблема
Голосовое распознавание немедленно прерывалось с ошибкой "No speech detected" (aborted).

## Причина
Web Speech API в Safari/WebKit требует, чтобы пользователь начал говорить **немедленно** после запуска распознавания. Даже небольшая задержка приводит к ошибке "no-speech" и прерыванию сессии.

## Решение
Переключились на **однократное распознавание** (`continuous: false`) вместо непрерывного режима:

### Изменения в `src/config/constants.ts`
```typescript
export const VOICE_CONFIG = {
  LANG: 'ru-RU',
  CONTINUOUS: false,  // Однократное распознавание для точности
  INTERIM_RESULTS: true,  // Промежуточные результаты для быстрой реакции
  MAX_ALTERNATIVES: 1,  // Только лучший результат
} as const;
```

### Изменения в `src/hooks/useVoice.ts`
1. **Добавлены все события распознавания** для отладки:
   - `onspeechstart` - когда пользователь начинает говорить
   - `onspeechend` - когда пользователь заканчивает говорить
   - `onaudiostart` / `onaudioend` - начало/конец захвата аудио
   - `onsoundstart` / `onsoundend` - обнаружение звука

2. **Улучшена логика запуска**:
   - Сброс предыдущей сессии через `abort()` перед новым запуском
   - Обработка ошибки "already started" с автоматическим перезапуском

3. **Упрощена обработка ошибок**:
   - "aborted" и "no-speech" больше не показываются пользователю
   - Это нормальное поведение API при паузах в речи

### Изменения в `src/pages/Voice.tsx`
1. **Убраны таймеры**:
   - Удален таймер обратного отсчета (countdown)
   - Удален таймер неактивности (timeLeft)
   - С `continuous: false` они не нужны - API сам завершает распознавание после паузы

2. **Упрощен UI**:
   - Убраны предупреждения о необходимости говорить немедленно
   - Простая инструкция: "Говорите сейчас" и "Сделайте паузу когда закончите"

3. **Автоматическая отправка**:
   - После завершения речи (пауза) транскрипция автоматически отправляется в AI
   - Пользователю не нужно нажимать дополнительные кнопки

## Как работает сейчас
1. Пользователь нажимает "Начать разговор"
2. Запрашивается доступ к микрофону
3. Немедленно запускается распознавание речи
4. Пользователь говорит свой вопрос
5. Когда пользователь делает паузу (~1-2 секунды), распознавание автоматически завершается
6. Транскрипция отправляется в AI
7. Галина отвечает голосом

## Преимущества нового подхода
- ✅ Стабильная работа без внезапных прерываний
- ✅ Естественное завершение по паузе
- ✅ Простой и понятный UX
- ✅ Не требует команд "завершить" или "стоп"
- ✅ Работает в Safari/WebKit без проблем

## Технические детали
- **Режим**: Однократное распознавание (`continuous: false`)
- **Язык**: Русский (`ru-RU`)
- **Промежуточные результаты**: Включены (`interimResults: true`)
- **Завершение**: Автоматически после паузы в речи
- **Микрофон**: Активен на протяжении всей сессии распознавания

