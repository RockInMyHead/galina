# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ LLM + RAG —á–µ—Ä–µ–∑ MCP

## –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **Retrieval-Augmented Generation (RAG)** —á–µ—Ä–µ–∑ **Model Context Protocol (MCP)** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **LangChain.js** –∏ **Tavily Search**.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Frontend ‚Üí Backend API ‚Üí LangChain Agent ‚Üí LLM (GPT-4-turbo)
                                      ‚Üì
                               MCP Client ‚Üí Tavily Search API ‚Üí –ò–Ω—Ç–µ—Ä–Ω–µ—Ç
                                      ‚Üì
                               –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ ‚Üí LLM ‚Üí –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–µ–π

#### OpenAI API Key
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://platform.openai.com/
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ API Keys
4. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á (–æ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)

#### Tavily Search API Key
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://tavily.com/
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å
3. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á –∏–∑ dashboard

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –î–ª—è Frontend (.env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞)
```env
VITE_OPENAI_API_KEY=sk-your-openai-key-here
VITE_TAVILY_API_KEY=tvly-your-tavily-key-here
VITE_OPENAI_MODEL=gpt-4-turbo
VITE_API_BASE_URL=https://lawyer.windexs.ru/api
```

#### –î–ª—è Backend (api/.env)
```env
OPENAI_API_KEY=sk-your-openai-key-here
OPENAI_MODEL=gpt-4-turbo
TAVILY_API_KEY=tvly-your-tavily-key-here
PORT=3003
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# Frontend
npm install

# Backend
cd api
npm install
```

### 4. –ó–∞–ø—É—Å–∫

```bash
# Backend (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
cd api
PORT=3003 node stable-server.js

# Frontend
npm run dev
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç

LLM –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ **–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç** —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏:

```javascript
// –ü—Ä–æ–º–ø—Ç –∞–≥–µ–Ω—Ç–∞
"–í—ã - –ì–∞–ª–∏–Ω–∞, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π AI-—é—Ä–∏—Å—Ç...
–ò–ù–°–¢–†–£–ú–ï–ù–¢–´: tavily_search_results_json
–ö–û–ì–î–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –ü–û–ò–°–ö: –î–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏..."
```

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–∏—Å–∫

LLM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ—à–∞–µ—Ç, –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –ø–æ–∏—Å–∫:
- ‚ùì –í–æ–ø—Ä–æ—Å—ã –æ —Ç–µ–∫—É—â–∏—Ö –∑–∞–∫–æ–Ω–∞—Ö –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- üìã –°—É–¥–µ–±–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –∏ –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç—ã
- üèõÔ∏è –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
- üÜï –ù–æ–≤–æ—Å—Ç–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

**–ó–∞–ø—Ä–æ—Å:** "–ö–∞–∫–∏–µ —à—Ç—Ä–∞—Ñ—ã –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ü–î–î –≤ 2024 –≥–æ–¥—É?"

1. LLM –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç: "–ù—É–∂–Ω—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —à—Ç—Ä–∞—Ñ–∞—Ö"
2. –í—ã–∑—ã–≤–∞–µ—Ç: `tavily_search_results_json`
3. Tavily –∏—â–µ—Ç: "—à—Ç—Ä–∞—Ñ—ã –ü–î–î –†–æ—Å—Å–∏—è 2024"
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
5. LLM —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Å—É–º–º–∞–º–∏ –∏ —Å—Å—ã–ª–∫–∞–º–∏

## Fallback —Ä–µ–∂–∏–º

–ï—Å–ª–∏ API –∫–ª—é—á–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã, —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ **—É–º–Ω–æ–º fallback —Ä–µ–∂–∏–º–µ**:

- üéØ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –æ—Ç–≤–µ—Ç—ã
- üìã –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
- ‚öñÔ∏è –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ mock –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –¢–µ—Å—Ç backend API
curl http://localhost:3003/test-proxy

# –¢–µ—Å—Ç chat API
curl -X POST http://localhost:3003/chat \
  -H "Content-Type: application/json" \
  -d '{"messages":[{"role":"user","content":"–ü—Ä–∏–≤–µ—Ç"}]}'
```

### –õ–æ–≥–∏

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏—â–∏—Ç–µ:
```
üîó Making API request to: https://lawyer.windexs.ru/api/chat
üß† Processing query with LangChain: [–∑–∞–ø—Ä–æ—Å]
‚úÖ LLM response generated with LangChain
```

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. "LangChain modules not available"
```
–†–µ—à–µ–Ω–∏–µ: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
cd api && npm install
```

#### 2. 404 –æ—à–∏–±–∫–∏
```
–†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Nginx –ø—Ä–æ–∫—Å–∏ –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

#### 3. –ù–µ—Ç –ø–æ–∏—Å–∫–∞ –≤ –æ—Ç–≤–µ—Ç–∞—Ö
```
–ü—Ä–∏—á–∏–Ω–∞: LLM —Ä–µ—à–∏–ª, —á—Ç–æ –ø–æ–∏—Å–∫ –Ω–µ –Ω—É–∂–µ–Ω
–†–µ—à–µ–Ω–∏–µ: –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å, —Ç—Ä–µ–±—É—é—â–∏–π –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
```

## Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ backend:**
   ```bash
   pm2 start stable-server.js --name galina-backend -- 3003
   ```
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx –ø—Ä–æ–∫—Å–∏**
4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ frontend**

### –ü—Ä–æ–≤–µ—Ä–∫–∞ production

```bash
# –¢–µ—Å—Ç API
curl https://lawyer.windexs.ru/api/test-proxy

# –¢–µ—Å—Ç LLM
curl -X POST https://lawyer.windexs.ru/api/chat \
  -H "Content-Type: application/json" \
  -d '{"messages":[{"role":"user","content":"–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω—É–∂–Ω—ã –¥–ª—è –û–û–û?"}]}'
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–∞

–í –ª–æ–≥–∞—Ö backend –∏—â–∏—Ç–µ:
```
üß† Processing query with LangChain: [–∑–∞–ø—Ä–æ—Å]
üîç MCP Search Tool called with query: [–ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å]
‚úÖ Found X search results
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ë–µ–∑ –ø–æ–∏—Å–∫–∞**: ~0.5-1 —Å–µ–∫
- **–° –ø–æ–∏—Å–∫–æ–º**: ~3-5 —Å–µ–∫
- **Fallback —Ä–µ–∂–∏–º**: ~0.1 —Å–µ–∫

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

```javascript
// –í langchainAgent.ts –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
const tools = [
  new TavilySearchResults({ maxResults: 3 }),
  new YourCustomTool(),
];
```

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã

```javascript
// –ò–∑–º–µ–Ω–∏—Ç–µ system –ø—Ä–æ–º–ø—Ç –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
const prompt = ChatPromptTemplate.fromMessages([
  ["system", "–í—ã - —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ [—Ç–µ–º–∞]..."],
  // ...
]);
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend: `pm2 logs galina-backend`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. –°–æ–∑–¥–∞–π—Ç–µ issue –Ω–∞ GitHub

## –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è LLM —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:
```bash
git pull origin main
npm install  # frontend
cd api && npm install  # backend
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
```
