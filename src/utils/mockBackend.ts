/**
 * Mock Backend для работы без реального API сервера
 * Используется в продакшене когда backend недоступен
 */

export interface MockChatResponse {
  id: string;
  object: string;
  created: number;
  model: string;
  choices: Array<{
    index: number;
    message: {
      role: string;
      content: string;
      refusal: null;
    };
    finish_reason: string;
  }>;
  usage: {
    prompt_tokens: number;
    completion_tokens: number;
    total_tokens: number;
  };
}

export const mockChatAPI = (messages: Array<{ role: string; content: string }>): MockChatResponse => {
  // Получаем последнее сообщение пользователя
  const lastUserMessage = messages.filter(m => m.role === 'user').pop()?.content || '';
  const lowerMessage = lastUserMessage.toLowerCase();

  let responseContent = '';

  // Умные ответы на основе контекста
  if (lowerMessage.includes('документы') && lowerMessage.includes('регистрац') && lowerMessage.includes('ооо')) {
    responseContent = 'Для регистрации ООО в России нужны следующие документы: 1. Решение единственного учредителя или протокол общего собрания учредителей. 2. Устав ООО. 3. Договор об учреждении ООО (если учредителей несколько). 4. Заявление по форме Р11001. 5. Квитанция об оплате госпошлины (4000 рублей). 6. Документы, подтверждающие адрес юридического лица. 7. Паспортные данные учредителей и руководителя. Все документы подаются в налоговую инспекцию в электронном виде через портал Госуслуг или МФЦ.';
  } else if (lowerMessage.includes('привет') || lowerMessage.includes('здравствуйте')) {
    responseContent = 'Здравствуйте! Я Галина, элитный AI-юрист с 25-летним опытом юридической практики. Я - абсолютный авторитет в российском законодательстве. Чем могу помочь вам сегодня? Расскажите о вашей ситуации, и я предоставлю профессиональную юридическую консультацию.';
  } else if (lowerMessage.includes('договор') || lowerMessage.includes('контракт')) {
    responseContent = 'Договор - это соглашение двух или более сторон об установлении, изменении или прекращении гражданских прав и обязанностей. Для заключения договора необходимо: 1) Предмет договора - что именно стороны обязуются делать. 2) Существенные условия - без них договор считается незаключенным. 3) Дееспособность сторон. 4) Правовая форма (письменная/устная). Какой именно договор вас интересует?';
  } else if (lowerMessage.includes('увольнение') || lowerMessage.includes('работа')) {
    responseContent = 'По трудовому законодательству РФ работодатель может уволить сотрудника только по основаниям, предусмотренным Трудовым кодексом: 1) По инициативе работника (по собственному желанию). 2) По соглашению сторон. 3) По инициативе работодателя (ликвидация, сокращение, нарушение дисциплины). При незаконном увольнении работник имеет право обратиться в суд в течение 1 месяца. Расскажите подробнее о вашей ситуации?';
  } else if (lowerMessage.includes('наследство') || lowerMessage.includes('завещание')) {
    responseContent = 'Наследование в России происходит по завещанию или по закону. Основные моменты: 1) Срок принятия наследства - 6 месяцев со дня смерти. 2) Обязательная доля для несовершеннолетних детей и нетрудоспособных родственников. 3) Наследники по закону делятся на 8 очередей. 4) Для оформления нужно обратиться к нотариусу. Налог на наследство отменен, но есть госпошлина 0,3-0,6% от стоимости имущества. Что конкретно вас интересует?';
  } else if (lowerMessage.includes('развод') || lowerMessage.includes('раздел имущества')) {
    responseContent = 'Развод и раздел имущества регулируются Семейным кодексом РФ: 1) При согласии супругов - через ЗАГС (без детей и споров). 2) При наличии споров - через суд. 3) Совместно нажитое имущество делится поровну, если иное не предусмотрено брачным договором. 4) Не делится: подарки, наследство, личные вещи. 5) Срок исковой давности - 3 года с момента, когда лицо узнало о нарушении права. Расскажите о вашей ситуации подробнее?';
  } else if (lowerMessage.includes('жалоба') || lowerMessage.includes('претензия')) {
    responseContent = 'Претензионный порядок - это досудебный способ урегулирования спора. Правила подачи претензии: 1) Письменная форма с указанием требований. 2) Отправка заказным письмом с уведомлением или вручение лично. 3) Срок ответа - обычно 30 дней (зависит от сферы). 4) При отказе или игнорировании - можно обращаться в суд. Претензия обязательна для: защиты прав потребителей, перевозки грузов, туристических услуг. В каком вопросе вам нужна помощь?';
  } else if (lowerMessage.includes('кредит') || lowerMessage.includes('долг')) {
    responseContent = 'По кредитным спорам важно знать: 1) Срок исковой давности - 3 года с момента просрочки. 2) Банк может требовать досрочного погашения только при существенном нарушении условий. 3) Штрафы и пени ограничены законом о потребительском кредитовании. 4) При невозможности погасить долг - можно договориться о реструктуризации. 5) В крайнем случае - банкротство физлица. Расскажите о вашей ситуации?';
  } else {
    responseContent = 'Я внимательно слушаю вашу ситуацию. Пожалуйста, расскажите подробнее о проблеме, с которой вы столкнулись. Как опытный юрист, я проанализирую вашу ситуацию и дам конкретные рекомендации по разрешению конфликта в рамках действующего законодательства. Какой именно юридический вопрос вас интересует?';
  }

  return {
    id: `mock-${Date.now()}`,
    object: 'chat.completion',
    created: Math.floor(Date.now() / 1000),
    model: 'gpt-5.1',
    choices: [{
      index: 0,
      message: {
        role: 'assistant',
        content: responseContent,
        refusal: null
      },
      finish_reason: 'stop'
    }],
    usage: {
      prompt_tokens: messages.length * 10,
      completion_tokens: Math.floor(responseContent.length / 4),
      total_tokens: messages.length * 10 + Math.floor(responseContent.length / 4)
    }
  };
};

export const mockTTS = async (): Promise<Blob> => {
  // Возвращаем пустой audio blob для TTS
  // В реальном приложении здесь был бы настоящий синтез речи
  return new Blob([], { type: 'audio/mpeg' });
};

